#!/usr/bin/env bash

set -eo pipefail

BIN_DIR=$(cd $(dirname $0); pwd)
ROOT_DIR=$(dirname $BIN_DIR)
PERL=`which perl`

echo "-----> Found an index.md"
echo "-----> Markdown to HTML"

MARKDOWN_FILES=`find $1 -name "*.md"`

for f in $MARKDOWN_FILES; do
  NEWFILE=${f%.*}.html
  echo "       $f -> $NEWFILE"
  echo -e "<!DOCTYPE html>\n<html>\n<head>\n" > $NEWFILE
  echo -e "<title>Ashbury Mobile Device Management</title>\n" >> $NEWFILE
  echo -e "<meta name=\"description\" content=\"Parental analytics, alerts and intervention capabilities on childrens' mobile phones and tablets.\" />\n" >> $NEWFILE
  echo -e "<meta http-equiv=\"content-type\" content=\"text/html;charset=UTF-8\" />\n" >> $NEWFILE
  echo -e "<link href=\"/ashbury.css\" media=\"all\" rel=\"stylesheet\" type=\"text/css\" />\n" >> $NEWFILE
  echo -e "</head>\n<body>\n" >> $NEWFILE
  $PERL $ROOT_DIR/opt/Markdown.pl $f >> $NEWFILE
  echo -e "\n<small>Â© 2013 Ashbury Mobile Device Management, Inc.</small>\n</body>\n</html>" >> $NEWFILE
  rm $f
done 
